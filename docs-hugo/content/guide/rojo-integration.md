---
title: "Rojo Integration"
weight: 30
---

# Rojo Integration

This document describes how to use Apollo's Rojo integration features to compile entire Roblox projects written in Racket to Luau.

## Overview

The Apollo Rojo integration allows you to:

1. Compile entire Rojo project structures from Racket to Luau
2. Maintain proper module dependencies
3. Generate Roblox-compatible ModuleScripts
4. Preserve non-code assets and project structure
5. Automatically recompile on changes using watch mode

## Usage

### Command-Line Usage

There are two main ways to use the Rojo integration:

1.  **Using the main `apollo` executable with the `--rojo` flag:**

    ```bash
    # Basic usage
    ./dist/bin/apollo --rojo source_project -o output_project

    # Watch mode
    ./dist/bin/apollo --rojo source_project -o output_project --watch
    ```

2.  **Using the standalone `apollo-rojo` tool (recommended for dedicated Rojo workflows):**

    ```bash
    # Basic usage
    ./apollo-rojo.sh source_project -o output_project

    # Verbose mode
    ./apollo-rojo.sh source_project -o output_project -v

    # Watch mode
    ./apollo-rojo.sh source_project -o output_project --watch
    ```

    If installed, you can use `apollo-rojo` directly:

    ```bash
    apollo-rojo source_project -o output_project
    apollo-rojo source_project -o output_project --watch
    ```

### Options

- `-o, --output`: Specify the output directory (required for Rojo mode)
- `-v, --verbose`: Enable verbose output (available in `apollo-rojo`)
- `--watch`: Watch the source directory/file for changes and recompile automatically
- `--rojo`: (Used with main `apollo` command) Enables Rojo project compilation mode.

## Project Structure Example

The Rojo integration preserves your project structure while transforming Racket files to Luau:

```
source_project/
  ├── default.project.json
  ├── src/
  │   ├── module1.rkt
  │   ├── module2.rkt
  │   └── submodule/
  │       └── helper.rkt
  └── assets/
      └── images/
          └── logo.png

# Compiled with: apollo --rojo source_project -o output_project

output_project/
  ├── default.project.json
  ├── src/
  │   ├── module1.luau
  │   ├── module2.luau
  │   └── submodule/
  │       └── helper.luau
  └── assets/
      └── images/
          └── logo.png
```

## Module Dependencies

The integration automatically handles `require` statements in your Racket code and transforms them to proper Roblox `require` statements based on relative paths.

### Racket Code (`src/module1.rkt`):

```racket
#lang racket/base
(provide main-function)

;; Require a module in a subdirectory
(require "submodule/helper.rkt")

(define (main-function)
  (helper-function "Hello from Module 1"))
```

### Generated Luau (`output_project/src/module1.luau`):

```lua
-- Generated by Apollo Racket-to-Luau Compiler

local helper = require(script.Parent.submodule.helper)

local function main_function()
	return helper.helper_function("Hello from Module 1")
end

-- NOTE: Exports are currently placeholder
return {
    -- Export public functions and values
    -- This will be auto-populated in future versions
}
```
*(Note: Automatic export population is a planned future improvement.)*

## Rojo Integration Details

The Apollo Rojo integration component (`src/apollo/rojo/integration.rkt`):

1. Parses your `default.project.json` file (currently just checks existence, future versions may use its structure).
2. Recursively traverses the source directory.
3. Maintains all directory structures in the output directory.
4. For each `.rkt` file found, it invokes the core compiler pipeline (`parser` -> `ir` -> `codegen`).
5. It analyzes `require` statements in the Racket code to determine dependencies.
6. It wraps the generated Luau code in a standard Roblox `ModuleScript` structure, including generating appropriate `require()` calls for dependencies.
7. Copies all non-Racket files (assets, `.json`, etc.) as-is.
8. Integrates with the watch mode to recompile the entire project on any detected change within the source directory.

## Best Practices

1. Organize your Racket code in modules with clear dependencies.
2. Use relative paths in your require statements (e.g., `(require "../lib/utils.rkt")`, `(require "sibling.rkt")`).
3. Structure your project according to Rojo conventions, placing source code under paths defined in `default.project.json` (e.g., inside a `src` directory mapped to `ReplicatedStorage` or `ServerScriptService`).
4. Use a consistent naming scheme between files and modules.
5. Utilize the `--watch` flag during development for rapid feedback.

## Known Limitations

- Does not yet use the `$path` information from `default.project.json` to fully replicate Rojo's mapping; it currently mirrors the source directory structure directly within the output.
- Circular dependencies between modules may not be handled properly.
- Automatic export of `provide`d functions/values to the Luau `return` table is not yet implemented.
- Advanced Racket features may have limited Luau representations.
- Complex macros might not compile correctly.

## Future Improvements

- Fully utilize `default.project.json` for source mapping.
- Automatic detection and export of `provide`d bindings.
- Better handling of Roblox Instance types and FFI.
- Integration with Rojo build/sync commands.
- Support for multiple Rojo project files.
- More robust file watching (e.g., debouncing).

## Example Project

See the `examples/rojo-project` directory for a complete example of a Racket project structured for Rojo. 