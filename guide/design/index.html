<!doctype html><html lang=en-us dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en-us"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Design Document &#183; Apollo Compiler Documentation</title>
<meta name=title content="Design Document &#183; Apollo Compiler Documentation"><meta name=description content="Documentation for the Apollo Racket-to-Luau Compiler"><link rel=canonical href=https://dunnoconz.github.io/apollo/guide/design/><link type=text/css rel=stylesheet href=/apollo/css/main.bundle.min.446a8b9c076e66da0e80c76714e26dd9ec36f07c75a6f91f2ed5b9140c8f48bf53e431c5e426df98e3e593b9b3c6266a60d611aa69cce9f4811297f4d5772c6d.css integrity="sha512-RGqLnAduZtoOgMdnFOJt2ew28Hx1pvkfLtW5FAyPSL9T5DHF5CbfmOPlk7mzxiZqYNYRqmnM6fSBEpf01XcsbQ=="><script type=text/javascript src=/apollo/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/apollo/js/main.bundle.min.b6411b5d4cd56c0068d34c4acbce043846adad56b824e3d486a06d3459aed2eb7f7413874b7871cc2c822c8c8834cbed944022918bcc8cca710a962167c36d32.js integrity="sha512-tkEbXUzVbABo00xKy84EOEatrVa4JOPUhqBtNFmu0ut/dBOHS3hxzCyCLIyINMvtlEAikYvMjMpxCpYhZ8NtMg==" data-copy data-copied></script><script src=/apollo/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apollo/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/apollo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/apollo/favicon-16x16.png><link rel=manifest href=/apollo/site.webmanifest><meta property="og:url" content="https://dunnoconz.github.io/apollo/guide/design/"><meta property="og:site_name" content="Apollo Compiler Documentation"><meta property="og:title" content="Design Document"><meta property="og:description" content="Design Document: Racket-to-Luau Compiler for Roblox # 1. Introduction & Motivation # Roblox game development primarily uses Luau, a gradually typed language derived from Lua. While powerful, developers coming from other ecosystems might miss features from their preferred languages. Racket is a powerful, multi-paradigm language from the Lisp family, known for its strong macro system, functional programming capabilities, and optional static type system (Typed Racket)."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="guide"><meta name=twitter:card content="summary"><meta name=twitter:title content="Design Document"><meta name=twitter:description content="Design Document: Racket-to-Luau Compiler for Roblox # 1. Introduction & Motivation # Roblox game development primarily uses Luau, a gradually typed language derived from Lua. While powerful, developers coming from other ecosystems might miss features from their preferred languages. Racket is a powerful, multi-paradigm language from the Lisp family, known for its strong macro system, functional programming capabilities, and optional static type system (Typed Racket)."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Apollo Compiler Guide","name":"Design Document","headline":"Design Document","abstract":"\u003ch1 class=\u0022relative group\u0022\u003eDesign Document: Racket-to-Luau Compiler for Roblox \n    \u003cdiv id=\u0022design-document-racket-to-luau-compiler-for-roblox\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#design-document-racket-to-luau-compiler-for-roblox\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e        \n    \n\u003c\/h1\u003e\n\n\n\u003ch2 class=\u0022relative group\u0022\u003e1. Introduction \u0026amp; Motivation \n    \u003cdiv id=\u00221-introduction--motivation\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#1-introduction--motivation\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e        \n    \n\u003c\/h2\u003e\n\u003cp\u003eRoblox game development primarily uses Luau, a gradually typed language derived from Lua. While powerful, developers coming from other ecosystems might miss features from their preferred languages. Racket is a powerful, multi-paradigm language from the Lisp family, known for its strong macro system, functional programming capabilities, and optional static type system (Typed Racket).\u003c\/p\u003e","inLanguage":"en-us","url":"https:\/\/dunnoconz.github.io\/apollo\/guide\/design\/","author":{"@type":"Person","name":""},"mainEntityOfPage":"true","wordCount":"1284"}]</script><script src=/apollo/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/apollo/ class="text-base font-medium text-gray-500 hover:text-gray-900">Apollo Compiler Documentation</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/apollo/guide/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Guide</p></a><a href=/apollo/api/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>API Reference</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/apollo/guide/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Guide</p></a></li><li class=mt-1><a href=/apollo/api/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>API Reference</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Design Document</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=0001-01-01T00:00:00+00:00>January 1, 1</time><span class="px-2 text-primary-500">&#183;</span><span>1284 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">Design Document: Racket-to-Luau Compiler for Roblox<div id=design-document-racket-to-luau-compiler-for-roblox class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#design-document-racket-to-luau-compiler-for-roblox aria-label=Anchor>#</a></span></h1><h2 class="relative group">1. Introduction & Motivation<div id=1-introduction--motivation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-introduction--motivation aria-label=Anchor>#</a></span></h2><p>Roblox game development primarily uses Luau, a gradually typed language derived from Lua. While powerful, developers coming from other ecosystems might miss features from their preferred languages. Racket is a powerful, multi-paradigm language from the Lisp family, known for its strong macro system, functional programming capabilities, and optional static type system (Typed Racket).</p><p>This document outlines the design for a compiler that translates Racket (and Typed Racket) code into Luau, enabling developers to leverage Racket&rsquo;s features for building Roblox games and experiences. The primary goal is to combine Racket&rsquo;s expressiveness and safety (especially with Typed Racket) with the ability to target the popular Roblox platform.</p><p><strong>Target Audience:</strong> Racket developers interested in Roblox development, and Roblox developers looking for alternative language options with strong functional programming and metaprogramming features.</p><h2 class="relative group">2. Goals<div id=2-goals class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-goals aria-label=Anchor>#</a></span></h2><ul><li>Compile a practical subset of Racket and Typed Racket into functional, readable Luau code.</li><li>Support core Racket features: functions (including closures), <code>let</code>/<code>let*</code>/<code>letrec</code> bindings, basic data structures (lists, vectors, structs), modules (<code>require</code>/<code>provide</code>).</li><li>Leverage Typed Racket for static analysis, translating type annotations to Luau type hints where possible.</li><li>Provide mechanisms for interoperating with Roblox APIs (Luau functions, Instance manipulation, events).</li><li>Generate Luau code compatible with the Roblox engine environment.</li><li>Maintain reasonable performance, although parity with handwritten Luau is not a primary goal initially.</li><li>Preserve tail call optimization where feasible, as Luau supports proper tail calls.</li></ul><h2 class="relative group">3. Non-Goals<div id=3-non-goals class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-non-goals aria-label=Anchor>#</a></span></h2><ul><li>Complete Racket standard library support. The focus will be on core language features and Roblox interoperability.</li><li>Support for advanced Racket features like full continuation support (<code>call/cc</code>), complex contracts, or highly sophisticated procedural macros that are difficult to map to Luau.</li><li>Generating the absolute most performant Luau code possible; readability and correctness are prioritized initially.</li><li>Full macro compatibility; focus on macros that expand to core forms.</li></ul><h2 class="relative group">4. Architecture<div id=4-architecture class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-architecture aria-label=Anchor>#</a></span></h2><p>The compiler will adopt a multi-stage approach:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Racket/Typed Racket Code
</span></span><span style=display:flex><span>       |
</span></span><span style=display:flex><span>       V
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>|   Racket Frontend  |  (Leverages Racket&#39;s tools)
</span></span><span style=display:flex><span>|--------------------|
</span></span><span style=display:flex><span>| - Reader (S-expr)  |
</span></span><span style=display:flex><span>| - Expander (Macros)|
</span></span><span style=display:flex><span>| - Type Checker (TR)|
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>       |
</span></span><span style=display:flex><span>       V
</span></span><span style=display:flex><span> Core Racket AST / IR
</span></span><span style=display:flex><span> (Simplified Racket)
</span></span><span style=display:flex><span>       |
</span></span><span style=display:flex><span>       V
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>|      Compiler      |
</span></span><span style=display:flex><span>|--------------------|
</span></span><span style=display:flex><span>| - IR -&gt; Luau AST   |  (Main translation logic)
</span></span><span style=display:flex><span>| - Luau Code Gen    |
</span></span><span style=display:flex><span>| - (Opt.) Optimizer |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>       |
</span></span><span style=display:flex><span>       V
</span></span><span style=display:flex><span>  Luau Source Code
</span></span><span style=display:flex><span> (+ Runtime Library)
</span></span><span style=display:flex><span>       |
</span></span><span style=display:flex><span>       V
</span></span><span style=display:flex><span>   Roblox Engine
</span></span><span style=display:flex><span> (Luau VM)
</span></span></code></pre></div><ul><li><strong>Frontend (Racket-based):</strong><ul><li><strong>Parsing:</strong> Utilize Racket&rsquo;s built-in <code>read</code> function to parse S-expressions into Racket data structures.</li><li><strong>Expansion:</strong> Use Racket&rsquo;s <code>expand</code> function to handle macro expansion, converting macro uses into core Racket forms. This simplifies the compiler by offloading complex macro logic to the Racket system itself.</li><li><strong>Type Checking:</strong> For Typed Racket files (<code>#lang typed/racket</code>), invoke the Typed Racket type checker. Extract type information from the typed AST for potential use in Luau type annotation generation and ensuring type safety.</li></ul></li><li><strong>Intermediate Representation (IR):</strong><ul><li>Define a simplified IR representing core Racket semantics (e.g., lambda calculus with bindings, primitive operations, conditionals). This IR should be easier to translate directly to Luau constructs than the full Racket AST. It might strip away Racket-specific features already handled (like complex macros) and represent types explicitly if derived from Typed Racket.</li></ul></li><li><strong>Backend (Luau Generation):</strong><ul><li><strong>IR -> Luau AST:</strong> Translate the compiler&rsquo;s IR into an Abstract Syntax Tree representing Luau code. This involves mapping Racket concepts to Luau equivalents (see Section 5).</li><li><strong>Luau Code Generation:</strong> Pretty-print the Luau AST into valid Luau source code string(s).</li><li><strong>Optimization (Optional):</strong> Perform basic optimizations on the Luau AST or generated code, such as constant folding or simple dead code elimination. More advanced Luau-specific optimizations could be added later.</li></ul></li></ul><h2 class="relative group">5. Language Feature Mapping<div id=5-language-feature-mapping class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-language-feature-mapping aria-label=Anchor>#</a></span></h2><table><thead><tr><th style=text-align:left>Racket Feature</th><th style=text-align:left>Luau Target</th><th style=text-align:left>Notes</th></tr></thead><tbody><tr><td style=text-align:left>Numbers</td><td style=text-align:left><code>number</code></td><td style=text-align:left>Potential precision differences for non-integers.</td></tr><tr><td style=text-align:left>Strings</td><td style=text-align:left><code>string</code></td><td style=text-align:left>Generally straightforward mapping.</td></tr><tr><td style=text-align:left>Booleans (<code>#t</code>, <code>#f</code>)</td><td style=text-align:left><code>true</code>, <code>false</code></td><td style=text-align:left>Direct mapping.</td></tr><tr><td style=text-align:left>Symbols</td><td style=text-align:left><code>string</code></td><td style=text-align:left>Use strings. Ensure runtime handles symbol equality correctly if needed (e.g., interning via a table).</td></tr><tr><td style=text-align:left>Lists (<code>cons</code>, <code>car</code>, <code>cdr</code>)</td><td style=text-align:left>Luau Tables (arrays) + Runtime Library</td><td style=text-align:left>Requires runtime functions (<code>rt.cons</code>, <code>rt.car</code>, <code>rt.cdr</code>, <code>rt.isNull</code>). Likely represented as <code>{car_val, cdr_val}</code>.</td></tr><tr><td style=text-align:left>Vectors</td><td style=text-align:left>Luau Tables (arrays)</td><td style=text-align:left>Direct mapping using 1-based indexing adjustments.</td></tr><tr><td style=text-align:left>Structs</td><td style=text-align:left>Luau Tables + Metatables</td><td style=text-align:left>Use tables for fields. Metatables can mimic struct predicates and potentially methods.</td></tr><tr><td style=text-align:left><code>define</code> (top-level)</td><td style=text-align:left>Luau global/module variable</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>define</code> (internal)</td><td style=text-align:left>Luau <code>local</code> variable</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>lambda</code></td><td style=text-align:left>Luau <code>function</code></td><td style=text-align:left>Handle closures correctly (Luau supports this).</td></tr><tr><td style=text-align:left><code>let</code>, <code>let*</code></td><td style=text-align:left>Luau <code>local</code> variables, nested <code>do..end</code> blocks</td><td style=text-align:left>Straightforward lexical scoping.</td></tr><tr><td style=text-align:left><code>letrec</code></td><td style=text-align:left>Luau <code>local</code> variables, potentially forward declaration for functions</td><td style=text-align:left>Luau supports recursive local functions directly. Mutual recursion needs care.</td></tr><tr><td style=text-align:left><code>if</code>, <code>cond</code></td><td style=text-align:left>Luau <code>if</code>/<code>elseif</code>/<code>else</code></td><td style=text-align:left><code>cond</code> expands into nested <code>if</code> statements.</td></tr><tr><td style=text-align:left><code>begin</code></td><td style=text-align:left>Luau <code>do ... end</code> block or sequential statements</td><td style=text-align:left>Direct mapping.</td></tr><tr><td style=text-align:left>Modules (<code>require</code>/<code>provide</code>)</td><td style=text-align:left>Luau <code>ModuleScript</code> and <code>require</code></td><td style=text-align:left>Map <code>provide</code>d names to the returned table of the <code>ModuleScript</code>. Map <code>require</code> to Luau <code>require</code>.</td></tr><tr><td style=text-align:left>Typed Racket Types</td><td style=text-align:left>Luau Type Annotations (<code>:</code>), Runtime Checks (optional)</td><td style=text-align:left>Map base types (Number, String, Boolean) directly. Complex types (structs, unions, generics) might require runtime representation or loss of specificity.</td></tr><tr><td style=text-align:left>Tail Calls</td><td style=text-align:left>Luau Tail Calls</td><td style=text-align:left>Aim to generate Luau code that preserves tail calls where Racket uses them (Luau VM supports TCO).</td></tr><tr><td style=text-align:left>Exceptions</td><td style=text-align:left>Luau <code>error()</code>, <code>pcall()</code>/<code>xpcall()</code></td><td style=text-align:left>Map Racket&rsquo;s exception system to Luau&rsquo;s error handling mechanisms.</td></tr><tr><td style=text-align:left>FFI (Roblox APIs)</td><td style=text-align:left>Special forms/functions -> Direct Luau calls</td><td style=text-align:left>Define a mechanism (e.g., <code>(roblox-api "ServiceName" "Method" arg1 ...)</code> ) translated to <code>game:GetService("ServiceName"):Method(arg1, ...)</code></td></tr></tbody></table><h2 class="relative group">6. Runtime System (Luau)<div id=6-runtime-system-luau class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-runtime-system-luau aria-label=Anchor>#</a></span></h2><p>A crucial component is a runtime library written in Luau (<code>racket_runtime.luau</code> or similar), which must be included in the Roblox project. This library will provide:</p><ul><li>Implementations for core Racket functions not built into Luau (e.g., <code>cons</code>, <code>car</code>, <code>cdr</code>, <code>null?</code>, <code>list</code>, <code>vector->list</code>, <code>apply</code>, symbol handling).</li><li>Helper functions for struct creation and type checking (predicates).</li><li>Support for the module system linkage.</li><li>Potential implementations for parts of the numeric tower if needed beyond standard Luau numbers.</li></ul><h2 class="relative group">7. Roblox Integration<div id=7-roblox-integration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-roblox-integration aria-label=Anchor>#</a></span></h2><ul><li><strong>FFI:</strong> Introduce specific Racket forms or functions (e.g., <code>(import-roblox [GetService : (-> string Instance)])</code>) that the compiler recognizes and translates into direct calls to Roblox globals (<code>game</code>, <code>workspace</code>, etc.) or specific API methods. Type annotations from Typed Racket could help ensure correct API usage.</li><li><strong>Event Handling:</strong> Map Roblox events (e.g., <code>Instance.Event:Connect(...)</code>) to Racket functions. This might involve generating Luau closures that call back into the compiled Racket code. Example: <code>(roblox-connect some-instance "Touched" (lambda (hit) ...))</code></li></ul><h2 class="relative group">8. Build Process & Tooling<div id=8-build-process--tooling class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-build-process--tooling aria-label=Anchor>#</a></span></h2><ul><li>The compiler itself will likely be a Racket program, runnable from the command line: <code>racket compile.rkt --input game.rkt --output CoreScripts/game.luau</code></li><li>Integrate with tools like Rojo: The compiler could watch Racket source files and automatically output corresponding Luau <code>ModuleScript</code>s into a Rojo-managed directory structure.</li><li><strong>Debugging:</strong> This is challenging. Initially, debugging might have to occur at the Luau level. Future work could involve generating source maps to map Luau execution points back to the original Racket code.</li></ul><h2 class="relative group">9. Challenges<div id=9-challenges class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-challenges aria-label=Anchor>#</a></span></h2><ul><li><strong>Semantic Mismatches:</strong> Bridging the gap between Racket&rsquo;s features (e.g., exact numeric tower, macros, contracts) and Luau&rsquo;s capabilities.</li><li><strong>Performance:</strong> Generated code might be less performant than idiomatic Luau due to abstraction layers or the runtime library overhead.</li><li><strong>Standard Library:</strong> Deciding on and implementing the necessary subset of the Racket standard library in the Luau runtime.</li><li><strong>Macros:</strong> While relying on Racket&rsquo;s expander helps, ensuring macros expand to translatable core forms is key. Complex procedural macros interacting heavily with the compiler internals might not be supportable.</li><li><strong>Error Reporting:</strong> Mapping runtime errors in Luau back to the original Racket source location effectively.</li><li><strong>Luau Typing:</strong> Fully leveraging Luau&rsquo;s gradual type system when translating from Typed Racket, especially for complex types.</li></ul><h2 class="relative group">10. Future Work<div id=10-future-work class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-future-work aria-label=Anchor>#</a></span></h2><ul><li>Expand the subset of supported Racket features and libraries.</li><li>Implement more sophisticated optimizations targeting Luau.</li><li>Develop better debugging tools (source maps).</li><li>Explore support for more advanced Racket features if feasible (e.g., limited contract support).</li><li>Performance profiling and optimization of the runtime library and generated code.</li><li>Enhanced Roblox API bindings generation.</li></ul></div></div><script>var oid="views_guide/design.md",oid_likes="likes_guide/design.md"</script><script type=text/javascript src=/apollo/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/apollo/guide/structure/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Project Structure</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=0001-01-01T00:00:00+00:00>January 1, 1</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/apollo/guide/rojo-integration/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Rojo Integration</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=0001-01-01T00:00:00+00:00>January 1, 1</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/apollo/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://dunnoconz.github.io/apollo/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>